<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Consule</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css"
        integrity="sha384-TX8t27EcRE3e/ihU7zmQxVncDAy5uIKz4rEkgIXeMed4M0jlfIDPvg6uqKI2xXr2" crossorigin="anonymous">
</head>

<body class="container" style="margin-top: 50px;
	width: 50%; height:auto;">

    <h2 class="text-primary" style="margin-left: 15px; margin-bottom: 10px">Add Food Item</h2>

    <form class="container" id="contactForm" enctype="multipart/form-data">
        <div class="card">
            <div class="card-body">
                <div class="form-group">
                    <label for="Food_Category">Food Category</label>
                    <select class="form-control" id="Food_Category">
                        <!-- Options will be populated dynamically -->
                    </select>
                </div>
                <div class="form-group">
                    <label for="exampleFormControlInput1">Food Name</label>
                    <input type="text" class="form-control" id="Food_Name" placeholder="">
                </div>
                <div class="form-group">
                    <label for="exampleFormControlInput1">Food Price</label>
                    <input type="text" class="form-control" id="Food_Price" placeholder="">
                </div>
                <div class="form-group">
                    <label for="Food_Img">Food Image</label>
                    <input type="file" class="form-control-file" id="Food_Img" accept="image/*">
                </div>
            </div>
            <button type="submit" class="btn btn-primary" style="margin-left: 15px; margin-top: 10px">Submit</button>
        </div>
    </form>

    <script src="https://www.gstatic.com/firebasejs/3.7.4/firebase.js"></script>

    <script>
        let firebaseConfig = {
			apiKey: "AIzaSyAomp24GM3Yvve-7ttWc_HhGWNUCbZUBPI",
            authDomain: "qr-food-ordering-ab95d.firebaseapp.com",
            databaseURL: "https://qr-food-ordering-ab95d-default-rtdb.firebaseio.com",
            projectId: "qr-food-ordering-ab95d",
            storageBucket: "qr-food-ordering-ab95d.appspot.com",
            messagingSenderId: "294635791484",
            appId: "1:294635791484:web:aecc1aa12d08182a1dd5f9"
        };

        firebase.initializeApp(firebaseConfig);

        let foodCategoryRef = firebase.database().ref('Food_Category');
        let foodItemRef = firebase.database().ref('Food_Item');
        let storageRef = firebase.storage().ref();

        document.getElementById('contactForm').addEventListener('submit', submitForm);

        function submitForm(e) {
            e.preventDefault();

            // Get values
            let Food_Category = document.getElementById('Food_Category').value;
            let Food_Name = getInputVal('Food_Name');
            let Food_Price = getInputVal('Food_Price');
            let Food_Img = document.getElementById('Food_Img').files[0];

            // Upload image to Firebase Storage
            let imgRef = storageRef.child('Food_Img/' + Food_Img.name);
            imgRef.put(Food_Img).then(function (snapshot) {
                return snapshot.ref.getDownloadURL();
            }).then(function (downloadURL) {
                // Save message to Firebase Database with image URL
                saveMessage(Food_Category, Food_Name, Food_Price, downloadURL);
            }).catch(function (error) {
                console.error('Error uploading image: ', error);
            });

            document.getElementById('contactForm').reset();
        }

        // Function to get form values
        function getInputVal(id) {
            return document.getElementById(id).value;
        }

        // Save message to Firebase
        function saveMessage(Food_Category, Food_Name, Food_Price, Food_Img) {
            let query = foodItemRef.orderByKey().limitToLast(1);
            query.once('value', function (snapshot) {
                snapshot.forEach(function (childSnapshot) {
                    var lastKey = parseInt(childSnapshot.key) + 1;
                    var newKey = String(lastKey).padStart(6, '0'); // Ensure 6 digits with leading zeros
                    let newFoodItemRef = firebase.database().ref('Food_Item').child(newKey);

                    newFoodItemRef.set({
                        Food_Category: Food_Category,
                        Food_Name: Food_Name,
                        Food_Price: Food_Price,
                        Food_Img: Food_Img,
                    });
                });
            });
        }

        // Populate food category dropdown
        function populateFoodCategories() {
            foodCategoryRef.once('value', function (snapshot) {
                snapshot.forEach(function (childSnapshot) {
                    let categoryId = childSnapshot.key;
                    let categoryName = childSnapshot.val();
                    let option = document.createElement('option');
                    option.value = categoryName;
                    option.textContent = categoryName;
                    document.getElementById('Food_Category').appendChild(option);
                });
            });
        }

        // Call function to populate dropdown on page load
        populateFoodCategories();

    </script>
</body>

</html>
